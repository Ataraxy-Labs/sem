<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>sem — Agent Accuracy Benchmark</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0a0a0a;
      --fg: #e0e0e0;
      --dim: #666;
      --dim2: #444;
      --border: #222;
      --accent: #fff;
      --green: #4ade80;
      --yellow: #facc15;
      --red: #f87171;
      --blue: #60a5fa;
      --cyan: #22d3ee;
      --purple: #a78bfa;
      --orange: #fb923c;
      --surface: #111;
      --surface2: #141414;
      --mono: 'SF Mono', 'Cascadia Code', 'Fira Code', 'JetBrains Mono', monospace;
    }

    body {
      font-family: var(--mono);
      background: var(--bg);
      color: var(--fg);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    a { color: var(--fg); text-decoration-color: var(--dim); text-underline-offset: 3px; }
    a:hover { color: var(--accent); text-decoration-color: var(--accent); }

    .container { max-width: 800px; margin: 0 auto; padding: 0 24px; }

    /* Nav */
    nav {
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 50;
    }
    nav .logo { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; color: var(--accent); text-decoration: none; }
    nav .links { display: flex; gap: 20px; font-size: 13px; color: var(--dim); }

    /* Sections */
    section { padding: 60px 0; border-top: 1px solid var(--border); }
    section:first-of-type { border-top: none; }
    section h2 {
      font-size: 22px; font-weight: 600; color: var(--accent);
      margin-bottom: 12px; letter-spacing: -0.5px;
    }
    section .section-desc {
      font-size: 14px; color: var(--dim); margin-bottom: 32px; line-height: 1.7;
    }

    /* Benchmark bars */
    .bench-group { margin-bottom: 32px; }
    .bench-group h3 { font-size: 14px; color: var(--fg); margin-bottom: 16px; }
    .bench-row { margin-bottom: 12px; }
    .bench-label {
      display: flex; justify-content: space-between; font-size: 12px;
      margin-bottom: 4px;
    }
    .bench-label .name { color: var(--fg); }
    .bench-label .value { color: var(--dim); }
    .bench-bar-track {
      height: 24px; background: #181818; border-radius: 4px; overflow: hidden;
      position: relative;
    }
    .bench-bar {
      height: 100%; border-radius: 4px; display: flex; align-items: center;
      padding-left: 8px; font-size: 11px; color: #000; font-weight: 600;
      transition: width 0.8s ease-out;
    }
    .bench-bar.sem-bar { background: var(--green); }
    .bench-bar.git-bar { background: var(--blue); }
    .bench-multiplier {
      font-size: 12px; color: var(--green); font-weight: 600; margin-top: 4px;
    }

    /* Findings */
    .finding-card {
      padding: 16px; border: 1px solid var(--border); border-radius: 8px;
      margin-bottom: 12px;
    }
    .finding-card h4 { font-size: 13px; color: var(--accent); margin-bottom: 8px; }
    .finding-example {
      font-size: 12px; line-height: 1.6; padding: 10px 14px;
      background: var(--surface); border-radius: 6px; margin-top: 8px;
    }

    /* Terminal color classes */
    .d { color: var(--dim2); }
    .g { color: var(--green); }
    .r { color: var(--red); }
    .b { color: var(--blue); }

    /* Footer */
    footer {
      padding: 40px 0; border-top: 1px solid var(--border);
      text-align: center; font-size: 12px; color: var(--dim);
    }

    @media (max-width: 640px) {
      nav .links { gap: 12px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav>
      <a class="logo" href="index.html">sem</a>
      <div class="links">
        <a href="index.html#commands">Commands</a>
        <a href="index.html#formats">Formats</a>
        <a href="index.html#output">Output</a>
        <a href="index.html#benchmarks">Benchmarks</a>
        <a href="agents.html">Agents</a>
        <a href="changelog.html">Changelog</a>
        <a href="https://github.com/Ataraxy-Labs/sem">GitHub</a>
        <a href="llms.txt">llms.txt</a>
      </div>
    </nav>

    <!-- Agent Accuracy -->
    <section id="agent-accuracy">
      <h2>Agent accuracy</h2>
      <p class="section-desc">
        Same questions about code changes, answered by Claude Sonnet 4.5. One gets <code style="color:var(--green)">sem diff</code> JSON, the other gets raw <code style="color:var(--blue)">git diff</code>. Scored against ground truth across 3 commits (small, medium, large).
      </p>

      <div style="display: flex; gap: 14px; margin-bottom: 24px; font-size: 12px;">
        <div style="display: flex; align-items: center; gap: 6px;">
          <div style="width: 12px; height: 12px; border-radius: 2px; background: var(--green);"></div>
          <span style="color: var(--dim);">sem diff</span>
        </div>
        <div style="display: flex; align-items: center; gap: 6px;">
          <div style="width: 12px; height: 12px; border-radius: 2px; background: var(--blue);"></div>
          <span style="color: var(--dim);">git diff</span>
        </div>
      </div>

      <div class="bench-group" id="agent-bench-mount">
        <div class="bench-row">
          <div class="bench-label">
            <span class="name">Q1: List added functions (F1)</span>
            <span class="value" id="q1-values"></span>
          </div>
          <div style="display: flex; gap: 4px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar sem-bar" id="q1-sem-bar" style="width: 0%"></div>
            </div>
          </div>
          <div style="display: flex; gap: 4px; margin-top: 2px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar git-bar" id="q1-git-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="bench-row" style="margin-top: 16px;">
          <div class="bench-label">
            <span class="name">Q2: Files with modified entities (F1)</span>
            <span class="value" id="q2-values"></span>
          </div>
          <div style="display: flex; gap: 4px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar sem-bar" id="q2-sem-bar" style="width: 0%"></div>
            </div>
          </div>
          <div style="display: flex; gap: 4px; margin-top: 2px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar git-bar" id="q2-git-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="bench-row" style="margin-top: 16px;">
          <div class="bench-label">
            <span class="name">Q3: Entity type counts (accuracy)</span>
            <span class="value" id="q3-values"></span>
          </div>
          <div style="display: flex; gap: 4px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar sem-bar" id="q3-sem-bar" style="width: 0%"></div>
            </div>
          </div>
          <div style="display: flex; gap: 4px; margin-top: 2px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar git-bar" id="q3-git-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="bench-row" style="margin-top: 16px;">
          <div class="bench-label">
            <span class="name">Q4: Added/modified/deleted counts (exact)</span>
            <span class="value" id="q4-values"></span>
          </div>
          <div style="display: flex; gap: 4px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar sem-bar" id="q4-sem-bar" style="width: 0%"></div>
            </div>
          </div>
          <div style="display: flex; gap: 4px; margin-top: 2px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar git-bar" id="q4-git-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div id="agent-bench-overall" style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: baseline;">
          <span style="font-size: 14px; color: var(--accent); font-weight: 600;">Overall average</span>
          <span id="overall-values" style="font-size: 13px;"></span>
        </div>
        <div id="agent-bench-delta" class="bench-multiplier" style="margin-top: 8px;"></div>
      </div>

      <!-- Detailed findings -->
      <h3 style="font-size: 16px; color: var(--accent); margin: 40px 0 12px;">Why git diff fails agents</h3>
      <p class="section-desc" style="margin-bottom: 16px;">
        Tested on 3 commits from this repo. Each exposes a different failure mode when agents reason about raw line diffs.
      </p>

      <div class="finding-card">
        <h4>Line/entity confusion <span style="color: var(--dim); font-weight: 400;">— Q4 on all commits</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          git diff has no concept of "entity." When asked to count added entities, the model counts <code style="color:var(--cyan)">+</code> lines instead.
          On the speed optimization commit (<code style="color:var(--cyan)">fffb38f</code>), git-based Claude reported <span style="color:var(--red)">238 added</span> — the number of <code style="color:var(--cyan)">+</code> lines in the diff.
          The actual count is <span style="color:var(--green)">32 added entities</span>. On the Rust rewrite, it said <span style="color:var(--red)">1,122</span> vs truth of <span style="color:var(--green)">259</span>.
        </p>
        <div class="finding-example">
          <span class="d">git-based:</span> <span class="r">{"added": 238, "modified": 10, "deleted": 0}</span><br>
          <span class="d">sem-based:</span> <span class="g">{"added": 32, "modified": 10, "deleted": 3}</span> <span class="d">// exact match</span>
        </div>
      </div>

      <div class="finding-card">
        <h4>No entity type ontology <span style="color: var(--dim); font-weight: 400;">— Q3 on all commits</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          Line diffs have no AST. On commit <code style="color:var(--cyan)">9f7f1c7</code> (7 new commands), git-based Claude returned <code style="color:var(--red)">{"file": 11}</code> — it counted files, not entities.
          Truth: <code style="color:var(--green)">{"interface": 12, "function": 15, "variable": 3, "class": 1}</code>.
          On the Rust rewrite, it found 16 functions when there are 87, and completely missed <code style="color:var(--cyan)">chunk</code> (80), <code style="color:var(--cyan)">property</code> (29), <code style="color:var(--cyan)">impl</code> (10).
        </p>
      </div>

      <div class="finding-card">
        <h4>Can't distinguish add vs modify <span style="color: var(--dim); font-weight: 400;">— Q1, Q2</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          Modified functions show <code style="color:var(--cyan)">+</code> and <code style="color:var(--cyan)">-</code> hunks, same as new functions in changed files. On <code style="color:var(--cyan)">fffb38f</code>,
          git-based Claude listed 9 "added" functions — 4 were actually modified (<code style="color:var(--dim)">detectJsonChanges</code>, <code style="color:var(--dim)">parseDiffNameStatus</code>, <code style="color:var(--dim)">detectAndGetFiles</code>, <code style="color:var(--dim)">populateContent</code>).
          Precision dropped to 55.6%. sem tags each entity with <code style="color:var(--green)">changeType: "added"</code> vs <code style="color:var(--yellow)">changeType: "modified"</code>.
        </p>
      </div>

      <div class="finding-card">
        <h4>Config file blindness <span style="color: var(--dim); font-weight: 400;">— Q2, Q3</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          JSON/YAML/TOML changes appear as raw <code style="color:var(--cyan)">+</code>/<code style="color:var(--cyan)">-</code> key-value lines. The model doesn't classify these as "entities."
          On <code style="color:var(--cyan)">fffb38f</code>, git-based Claude missed <code style="color:var(--dim)">package.json</code> and <code style="color:var(--dim)">package-lock.json</code> as containing modified entities (recall dropped to 66.7%).
          sem reports <code style="color:var(--green)">entityType: "property"</code> for each changed key.
        </p>
      </div>

      <div class="finding-card">
        <h4>Context window pressure <span style="color: var(--dim); font-weight: 400;">— Q1 on large diffs</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          Both tools degrade on the 3,905-line Rust rewrite (<code style="color:var(--cyan)">ae576ab</code>). git diff was truncated at 100KB — the model found 25/67 added functions (37% recall).
          sem's stripped JSON is much more compact (no source code), so the model saw all 278 entities but still only extracted 43/67 (64% recall).
          sem wins, but large diffs are where attention limits hurt regardless of format.
        </p>
      </div>

      <p style="font-size: 11px; color: var(--dim2); margin-top: 20px;">
        3 commits &times; 4 questions &times; 2 tools = 24 API calls. Claude Sonnet 4.5, temperature 0. Content fields stripped from sem JSON for fair comparison.
        <a href="https://github.com/Ataraxy-Labs/sem/blob/main/bench/agent-accuracy.py" style="color: var(--dim);">Reproduce &rarr;</a>
      </p>
    </section>

    <footer>
      <p>Built by <a href="https://ataraxy-labs.com">Ataraxy Labs</a></p>
    </footer>
  </div>

  <script>
    // Agent accuracy benchmark results
    (function() {
      const data = {
        q1_added_functions:{ sem: 0.9274, git: 0.7526 },
        q2_files_with_modified:{ sem: 1.0000, git: 0.5519 },
        q3_entity_type_counts:{ sem: 0.9083, git: 0.1346 },
        q4_change_type_counts:{ sem: 1.0000, git: 0.2222 },
      };

      const qs = ['q1', 'q2', 'q3', 'q4'];
      const keys = ['q1_added_functions', 'q2_files_with_modified', 'q3_entity_type_counts', 'q4_change_type_counts'];

      keys.forEach((key, i) => {
        const q = qs[i];
        const sem = data[key].sem;
        const git = data[key].git;
        const semBar = document.getElementById(q + '-sem-bar');
        const gitBar = document.getElementById(q + '-git-bar');
        const values = document.getElementById(q + '-values');
        if (semBar) semBar.style.width = (sem * 100) + '%';
        if (gitBar) gitBar.style.width = (git * 100) + '%';
        if (semBar) semBar.textContent = sem > 0.08 ? (sem * 100).toFixed(0) + '%' : '';
        if (gitBar) gitBar.textContent = git > 0.08 ? (git * 100).toFixed(0) + '%' : '';
        if (values) values.innerHTML = '<span style="color:var(--green)">' + (sem * 100).toFixed(0) + '%</span> vs <span style="color:var(--blue)">' + (git * 100).toFixed(0) + '%</span>';
      });

      const allSem = keys.map(k => data[k].sem);
      const allGit = keys.map(k => data[k].git);
      const semAvg = allSem.reduce((a,b) => a+b, 0) / allSem.length;
      const gitAvg = allGit.reduce((a,b) => a+b, 0) / allGit.length;
      const overall = document.getElementById('overall-values');
      if (overall) overall.innerHTML = '<span style="color:var(--green)">' + (semAvg * 100).toFixed(0) + '%</span> vs <span style="color:var(--blue)">' + (gitAvg * 100).toFixed(0) + '%</span>';
      const delta = document.getElementById('agent-bench-delta');
      if (delta && semAvg > gitAvg) {
        const pct = ((semAvg - gitAvg) / gitAvg * 100).toFixed(0);
        delta.textContent = 'Structured sem diff improves agent accuracy by +' + pct + '% over raw line diffs.';
      }
    })();
  </script>
</body>
</html>
