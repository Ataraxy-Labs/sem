<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>sem — Semantic Version Control</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0a0a0a;
      --fg: #e0e0e0;
      --dim: #666;
      --dim2: #444;
      --border: #222;
      --accent: #fff;
      --green: #4ade80;
      --yellow: #facc15;
      --red: #f87171;
      --blue: #60a5fa;
      --cyan: #22d3ee;
      --purple: #a78bfa;
      --orange: #fb923c;
      --surface: #111;
      --surface2: #141414;
      --mono: 'SF Mono', 'Cascadia Code', 'Fira Code', 'JetBrains Mono', monospace;
    }

    body {
      font-family: var(--mono);
      background: var(--bg);
      color: var(--fg);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    a { color: var(--fg); text-decoration-color: var(--dim); text-underline-offset: 3px; }
    a:hover { color: var(--accent); text-decoration-color: var(--accent); }

    .container { max-width: 800px; margin: 0 auto; padding: 0 24px; }

    /* Nav */
    nav {
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 50;
    }
    nav .logo { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; color: var(--accent); }
    nav .links { display: flex; gap: 20px; font-size: 13px; color: var(--dim); }

    /* Install box */
    .install-box:hover { border-color: #444 !important; }
    .install-box .copied.show { opacity: 1 !important; }

    /* Terminal */
    .terminal {
      background: #0d0d0d; border: 1px solid var(--border);
      border-radius: 10px; margin: 24px 0; overflow: hidden;
    }
    .terminal-bar {
      background: var(--surface2); padding: 10px 16px;
      display: flex; align-items: center; gap: 8px;
      border-bottom: 1px solid var(--border);
    }
    .terminal-dot { width: 10px; height: 10px; border-radius: 50%; background: #333; }
    .terminal-title { font-size: 12px; color: var(--dim); margin-left: 8px; }
    .terminal-body {
      padding: 20px 24px; font-size: 13px; line-height: 1.7; overflow-x: auto;
    }
    .terminal-body .cmd { color: var(--accent); }
    .terminal-body .g { color: var(--green); }
    .terminal-body .y { color: var(--yellow); }
    .terminal-body .r { color: var(--red); }
    .terminal-body .d { color: var(--dim2); }
    .terminal-body .b { color: var(--blue); }
    .terminal-body .c { color: var(--cyan); }
    .terminal-body .p { color: var(--purple); }
    .terminal-body .o { color: var(--orange); }
    .terminal-body .w { color: var(--accent); font-weight: 600; }

    /* Sections */
    section { padding: 60px 0; border-top: 1px solid var(--border); }
    section h2 {
      font-size: 22px; font-weight: 600; color: var(--accent);
      margin-bottom: 12px; letter-spacing: -0.5px;
    }
    section .section-desc {
      font-size: 14px; color: var(--dim); margin-bottom: 32px; line-height: 1.7;
    }

    /* Tables */
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th {
      text-align: left; padding: 10px 16px; color: var(--dim);
      font-weight: 400; border-bottom: 1px solid var(--border);
    }
    td { padding: 10px 16px; border-bottom: 1px solid #181818; color: var(--fg); }
    tr:last-child td { border-bottom: none; }
    td.win { color: var(--green); font-weight: 600; }
    td.lose { color: var(--dim); }
    td.na { color: var(--dim2); }

    /* Comparison table */
    .comparison-table { overflow-x: auto; }
    .comparison-table table { min-width: 640px; }
    .comparison-table th:first-child { width: 200px; }
    .check { color: var(--green); }
    .cross { color: var(--red); }
    .meh { color: var(--yellow); }

    /* Commands */
    .commands { display: flex; flex-direction: column; gap: 12px; }
    .cmd-row { display: flex; gap: 16px; align-items: baseline; }
    .cmd-row code {
      background: var(--surface); padding: 6px 12px; border-radius: 6px;
      font-size: 13px; color: var(--fg); white-space: nowrap; flex-shrink: 0;
      min-width: 260px;
    }
    .cmd-row span { font-size: 12px; color: var(--dim); }

    /* Benchmark bars */
    .bench-group { margin-bottom: 32px; }
    .bench-group h3 { font-size: 14px; color: var(--fg); margin-bottom: 16px; }
    .bench-row { margin-bottom: 12px; }
    .bench-label {
      display: flex; justify-content: space-between; font-size: 12px;
      margin-bottom: 4px;
    }
    .bench-label .name { color: var(--fg); }
    .bench-label .value { color: var(--dim); }
    .bench-bar-track {
      height: 24px; background: #181818; border-radius: 4px; overflow: hidden;
      position: relative;
    }
    .bench-bar {
      height: 100%; border-radius: 4px; display: flex; align-items: center;
      padding-left: 8px; font-size: 11px; color: #000; font-weight: 600;
      transition: width 0.8s ease-out;
    }
    .bench-bar.sem-bar { background: var(--green); }
    .bench-bar.git-bar { background: var(--blue); }
    .bench-multiplier {
      font-size: 12px; color: var(--green); font-weight: 600; margin-top: 4px;
    }

    /* Flame graph section */
    .flame-legend { display: flex; gap: 14px; flex-wrap: wrap; margin: 16px 0 20px; }
    .flame-legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--dim); }
    .flame-swatch { width: 12px; height: 12px; border-radius: 2px; }
    .flame-container {
      border: 1px solid var(--border); border-radius: 8px; overflow: hidden;
      background: var(--surface);
    }
    .flame-header {
      padding: 10px 16px; border-bottom: 1px solid var(--border);
      font-size: 13px; color: var(--fg); display: flex;
      justify-content: space-between; align-items: center;
    }
    .flame-header .flame-stats { color: var(--dim); font-size: 12px; }
    .flame-body { padding: 12px; overflow-x: auto; }
    .flame-tooltip {
      position: fixed; background: #222; border: 1px solid #555; padding: 8px 12px;
      border-radius: 4px; font-size: 12px; pointer-events: none; z-index: 100;
      display: none; max-width: 500px;
    }
    .flame-tooltip .tt-fn { color: #fff; font-weight: bold; }
    .flame-tooltip .tt-detail { color: #aaa; margin-top: 4px; }

    /* Profiler breakdown */
    .profiler-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 24px; }
    .profiler-card {
      padding: 20px; border: 1px solid var(--border); border-radius: 8px;
    }
    .profiler-card h4 { font-size: 13px; color: var(--accent); margin-bottom: 12px; }
    .profiler-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 4px 0; font-size: 12px;
    }
    .profiler-row .pr-label { color: var(--dim); }
    .profiler-row .pr-value { color: var(--fg); font-weight: 600; }
    .profiler-row .pr-bar {
      flex: 1; height: 6px; background: #1a1a1a; border-radius: 3px;
      margin: 0 12px; overflow: hidden;
    }
    .profiler-row .pr-fill { height: 100%; border-radius: 3px; }

    /* Command docs */
    .cmd-doc { margin-bottom: 28px; }
    .cmd-doc-header {
      display: flex; align-items: baseline; gap: 12px; margin-bottom: 6px;
    }
    .cmd-doc-name {
      font-size: 14px; font-weight: 600; color: var(--accent);
      background: var(--surface); padding: 4px 10px; border-radius: 4px;
    }
    .cmd-doc-desc { font-size: 13px; color: var(--dim); }
    .cmd-doc-flags { margin-top: 8px; padding-left: 16px; }
    .cmd-doc-flags .flag {
      font-size: 12px; color: var(--fg); margin-bottom: 2px;
    }
    .cmd-doc-flags .flag code {
      color: var(--cyan); background: none; padding: 0;
    }
    .cmd-doc-flags .flag span { color: var(--dim); }

    /* Footer */
    footer {
      padding: 40px 0; border-top: 1px solid var(--border);
      text-align: center; font-size: 12px; color: var(--dim);
    }

    /* Changelog */
    .changelog-entry { padding: 20px 0; border-bottom: 1px solid #181818; }
    .changelog-entry:last-child { border-bottom: none; }
    .changelog-sha {
      font-size: 12px; color: var(--cyan); background: var(--surface);
      padding: 2px 8px; border-radius: 4px; margin-right: 8px;
    }
    .changelog-tag {
      font-size: 11px; padding: 2px 8px; border-radius: 4px; margin-right: 6px;
    }
    .changelog-tag.feat { background: #1a2e1a; color: var(--green); }
    .changelog-tag.perf { background: #2e2a1a; color: var(--yellow); }
    .changelog-tag.fix { background: #2e1a1a; color: var(--red); }
    .changelog-tag.rewrite { background: #1a1a2e; color: var(--blue); }
    .changelog-tag.docs { background: #1e1a2e; color: var(--purple); }
    .changelog-title { font-size: 14px; color: var(--accent); font-weight: 600; margin-bottom: 6px; }
    .changelog-body { font-size: 12px; color: var(--dim); line-height: 1.7; }
    .changelog-stats { font-size: 11px; color: var(--dim2); margin-top: 8px; }
    .changelog-mistake {
      margin-top: 10px; padding: 10px 14px; border-left: 2px solid var(--yellow);
      background: #1a1a0f; font-size: 12px; color: var(--dim); line-height: 1.6;
    }
    .changelog-mistake strong { color: var(--yellow); font-weight: 600; }

    /* Findings */
    .finding-card {
      padding: 16px; border: 1px solid var(--border); border-radius: 8px;
      margin-bottom: 12px;
    }
    .finding-card h4 { font-size: 13px; color: var(--accent); margin-bottom: 8px; }
    .finding-example {
      font-size: 12px; line-height: 1.6; padding: 10px 14px;
      background: var(--surface); border-radius: 6px; margin-top: 8px;
    }

    @media (max-width: 640px) {
      .profiler-grid { grid-template-columns: 1fr; }
      .cmd-row { flex-direction: column; gap: 4px; }
      .cmd-row code { min-width: auto; }
      nav .links { gap: 12px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav>
      <div class="logo">sem</div>
      <div class="links">
        <a href="#commands">Commands</a>
        <a href="#formats">Formats</a>
        <a href="#output">Output</a>
        <a href="#benchmarks">Benchmarks</a>
        <a href="#agent-accuracy">Agents</a>
        <a href="#changelog">Changelog</a>
        <a href="https://github.com/Ataraxy-Labs/sem">GitHub</a>
      </div>
    </nav>

    <!-- ═══ Header ═══ -->
    <div style="padding: 48px 0 32px; text-align: center;">
      <h1 style="font-size: 36px; font-weight: 700; color: var(--accent); letter-spacing: -1.5px; margin-bottom: 12px;">Know what changed.</h1>
      <p style="font-size: 14px; color: var(--dim); margin-bottom: 24px; line-height: 1.7; max-width: 520px; margin-left: auto; margin-right: auto;">
        Entity-level diffs on top of Git. Structured output for AI agents, CI pipelines, and humans who want more than line numbers.
      </p>
      <div class="install-box" onclick="copyCmd(this, 'brew install sem-diff')" style="display: inline-block; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 10px 20px; font-size: 14px; color: var(--fg); cursor: pointer; position: relative;">
        <span class="copied" style="position: absolute; top: -28px; left: 50%; transform: translateX(-50%); font-size: 12px; color: var(--green); opacity: 0; transition: opacity 0.2s;">copied</span>
        <span style="color: var(--dim);">$</span> brew install sem-diff
      </div>
      <div style="margin-top: 12px; font-size: 12px; color: var(--dim2);">
        or: <span onclick="copyCmd(this, 'curl -fsSL https://sem.sh/install | sh')" style="color: var(--dim); cursor: pointer; border-bottom: 1px dashed var(--dim2);">curl -fsSL https://sem.sh/install | sh</span>
        &nbsp;&bull;&nbsp;
        <span onclick="copyCmd(this, 'cargo install --git https://github.com/Ataraxy-Labs/sem --path crates/sem-cli')" style="color: var(--dim); cursor: pointer; border-bottom: 1px dashed var(--dim2);">cargo install</span>
      </div>
    </div>

    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot"></div>
        <div class="terminal-dot"></div>
        <div class="terminal-dot"></div>
        <div class="terminal-title">~/project</div>
      </div>
      <div class="terminal-body">
<pre><span class="cmd">$ sem diff</span>

<span class="d">┌─ src/auth/login.ts ──────────────────────────────────</span>
<span class="d">│</span>
<span class="d">│</span>  <span class="g">⊕</span> <span class="d">function </span> <span class="w">validateToken</span>          <span class="g">[added]</span>
<span class="d">│</span>  <span class="y">∆</span> <span class="d">function </span> <span class="w">authenticateUser</span>       <span class="y">[modified]</span>
<span class="d">│</span>  <span class="r">⊖</span> <span class="d">function </span> <span class="w">legacyAuth</span>             <span class="r">[deleted]</span>
<span class="d">│</span>
<span class="d">└──────────────────────────────────────────────────────</span>

<span class="d">┌─ config/database.yml ─────────────────────────────────</span>
<span class="d">│</span>
<span class="d">│</span>  <span class="y">∆</span> <span class="d">property </span> <span class="w">production.pool_size</span>   <span class="y">[modified]</span>
<span class="d">│</span>    <span class="r">- 5</span>
<span class="d">│</span>    <span class="g">+ 20</span>
<span class="d">│</span>
<span class="d">└──────────────────────────────────────────────────────</span>

Summary: 1 added, 1 modified, 1 deleted across 2 files</pre>
      </div>
    </div>

    <!-- ═══ Commands ═══ -->
    <section id="commands">
      <h2>Commands</h2>
      <p class="section-desc">
        11 commands. Every command supports <code style="color:var(--cyan)">--format json</code> for machine-readable output.
      </p>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem init</span>
          <span class="cmd-doc-desc">Initialize sem in the current repo</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><span>Creates .sem/ directory and SQLite database for queries, labels, and comments.</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem diff</span>
          <span class="cmd-doc-desc">Semantic diff of changes</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>-s, --staged</code> <span>Show staged changes only</span></div>
          <div class="flag"><code>-c, --commit &lt;sha&gt;</code> <span>Diff a specific commit</span></div>
          <div class="flag"><code>--from &lt;ref&gt; --to &lt;ref&gt;</code> <span>Diff a commit range</span></div>
          <div class="flag"><code>-f, --format &lt;fmt&gt;</code> <span>terminal (default) or json</span></div>
          <div class="flag"><code>--store</code> <span>Save changes to the database</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem status</span>
          <span class="cmd-doc-desc">Semantic status with entity counts</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>-f, --format &lt;fmt&gt;</code> <span>terminal or json</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem log</span>
          <span class="cmd-doc-desc">Semantic commit history</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>-n, --count &lt;n&gt;</code> <span>Number of commits (default: 5)</span></div>
          <div class="flag"><code>--store</code> <span>Save changes to the database</span></div>
          <div class="flag"><code>-f, --format &lt;fmt&gt;</code> <span>terminal or json</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem blame &lt;file&gt;</span>
          <span class="cmd-doc-desc">Entity-level blame — who last touched each function</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>-d, --depth &lt;n&gt;</code> <span>Commits to search (default: 50)</span></div>
          <div class="flag"><code>-f, --format &lt;fmt&gt;</code> <span>terminal or json</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem history &lt;entity&gt;</span>
          <span class="cmd-doc-desc">Full timeline of a single entity across commits</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>entity</code> <span>"auth.ts::function::login" or "auth.ts::login" or just "login"</span></div>
          <div class="flag"><code>-d, --depth &lt;n&gt;</code> <span>Commits to search (default: 50)</span></div>
          <div class="flag"><code>-f, --format &lt;fmt&gt;</code> <span>terminal or json</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem review &lt;branch|PR#&gt;</span>
          <span class="cmd-doc-desc">Semantic PR review with risk signals</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>-b, --base &lt;ref&gt;</code> <span>Base branch (default: main)</span></div>
          <div class="flag"><code>-f, --format &lt;fmt&gt;</code> <span>terminal or json</span></div>
          <div class="flag"><span>Flags: deleted functions, modified configs, large changesets</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem watch</span>
          <span class="cmd-doc-desc">Real-time semantic diff on file changes</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>--debounce &lt;ms&gt;</code> <span>Debounce interval (default: 500ms)</span></div>
          <div class="flag"><code>-f, --format &lt;fmt&gt;</code> <span>terminal or json</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem query &lt;sql&gt;</span>
          <span class="cmd-doc-desc">Run SQL against stored changes</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>sql</code> <span>Any SQL query against the .sem/sem.db database</span></div>
          <div class="flag"><code>-f, --format &lt;fmt&gt;</code> <span>terminal or json</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem label &lt;entity&gt; [label]</span>
          <span class="cmd-doc-desc">Add, remove, or list labels on entities</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>-r, --remove</code> <span>Remove the label</span></div>
          <div class="flag"><code>-l, --list</code> <span>List all labels for the entity</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">sem comment &lt;entity&gt; [body]</span>
          <span class="cmd-doc-desc">Threaded comments on entities</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>-a, --author &lt;name&gt;</code> <span>Comment author (defaults to git user.name)</span></div>
          <div class="flag"><code>--reply &lt;id&gt;</code> <span>Reply to an existing comment</span></div>
        </div>
      </div>
    </section>

    <!-- ═══ Supported formats ═══ -->
    <section id="formats">
      <h2>Supported formats</h2>
      <table>
        <thead>
          <tr><th>Format</th><th>Extensions</th><th>Entities</th></tr>
        </thead>
        <tbody>
          <tr><td>TypeScript</td><td>.ts .tsx</td><td>functions, classes, interfaces, types, enums</td></tr>
          <tr><td>JavaScript</td><td>.js .jsx .mjs .cjs</td><td>functions, classes, variables</td></tr>
          <tr><td>Python</td><td>.py</td><td>functions, classes, decorators</td></tr>
          <tr><td>Go</td><td>.go</td><td>functions, methods, types</td></tr>
          <tr><td>Rust</td><td>.rs</td><td>functions, structs, enums, impls, traits</td></tr>
          <tr><td>JSON</td><td>.json</td><td>properties, objects (RFC 6901 paths)</td></tr>
          <tr><td>YAML</td><td>.yml .yaml</td><td>sections, properties (dot paths)</td></tr>
          <tr><td>TOML</td><td>.toml</td><td>sections, properties</td></tr>
          <tr><td>CSV</td><td>.csv .tsv</td><td>rows (first column as ID)</td></tr>
          <tr><td>Markdown</td><td>.md .mdx</td><td>heading-based sections</td></tr>
        </tbody>
      </table>
    </section>

    <!-- ═══ How matching works ═══ -->
    <section>
      <h2>Entity matching</h2>
      <p class="section-desc">Three-phase algorithm that detects additions, modifications, deletions, renames, and moves.</p>
      <div class="commands">
        <div class="cmd-row">
          <code>Phase 1 — Exact ID</code>
          <span>Same entity ID in before/after? Modified or unchanged.</span>
        </div>
        <div class="cmd-row">
          <code>Phase 2 — Content hash</code>
          <span>Same SHA-256, different name? Renamed or moved.</span>
        </div>
        <div class="cmd-row">
          <code>Phase 3 — Fuzzy similarity</code>
          <span>>80% Jaccard token overlap? Probable rename.</span>
        </div>
      </div>
    </section>

    <!-- ═══ Output formats ═══ -->
    <section id="output">
      <h2>Output formats</h2>
      <p class="section-desc">
        Every command outputs structured JSON. Pipe sem into your AI agent, CI pipeline, or automation.
      </p>
      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-title">sem diff --format json | jq</div>
        </div>
        <div class="terminal-body">
<pre><span class="d">{</span>
  <span class="b">"summary"</span>: <span class="d">{</span>
    <span class="b">"fileCount"</span>: <span class="y">2</span>,
    <span class="b">"added"</span>: <span class="g">1</span>,
    <span class="b">"modified"</span>: <span class="y">1</span>,
    <span class="b">"deleted"</span>: <span class="r">1</span>,
    <span class="b">"total"</span>: <span class="w">3</span>
  <span class="d">}</span>,
  <span class="b">"changes"</span>: <span class="d">[</span>
    <span class="d">{</span>
      <span class="b">"entityId"</span>: <span class="c">"src/auth.ts::function::validateToken"</span>,
      <span class="b">"changeType"</span>: <span class="g">"added"</span>,
      <span class="b">"entityType"</span>: <span class="d">"function"</span>,
      <span class="b">"entityName"</span>: <span class="w">"validateToken"</span>,
      <span class="b">"filePath"</span>: <span class="d">"src/auth.ts"</span>
    <span class="d">}</span>
  <span class="d">]</span>
<span class="d">}</span></pre>
        </div>
      </div>

      <div class="terminal" style="margin-top: 16px;">
        <div class="terminal-bar">
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-title">SQL queries</div>
        </div>
        <div class="terminal-body">
<pre><span class="cmd">$ sem query "SELECT entity_name, change_type FROM changes WHERE entity_type = 'function'"</span>

entity_name          | change_type
--------------------------------------
validateToken        | added
authenticateUser     | modified
legacyAuth           | deleted</pre>
        </div>
      </div>
    </section>

    <!-- ═══ Validation ═══ -->
    <section>
      <h2>Validation rules</h2>
      <p class="section-desc">
        Define rules in <code style="color:var(--cyan)">.semrc.json</code>. sem diff auto-checks them.
      </p>
      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-title">.semrc.json</div>
        </div>
        <div class="terminal-body">
<pre><span class="d">{</span>
  <span class="b">"rules"</span>: <span class="d">[</span>
    <span class="d">{</span>
      <span class="b">"name"</span>: <span class="c">"no-delete-public-api"</span>,
      <span class="b">"match"</span>: <span class="d">{</span> <span class="b">"changeType"</span>: <span class="r">"deleted"</span>, <span class="b">"entityType"</span>: <span class="d">"function"</span> <span class="d">}</span>,
      <span class="b">"severity"</span>: <span class="r">"error"</span>,
      <span class="b">"message"</span>: <span class="c">"Public function deleted — this is a breaking change"</span>
    <span class="d">}</span>,
    <span class="d">{</span>
      <span class="b">"name"</span>: <span class="c">"pool-size-limit"</span>,
      <span class="b">"match"</span>: <span class="d">{</span> <span class="b">"entityType"</span>: <span class="d">"property"</span>, <span class="b">"filePath"</span>: <span class="d">"**/database.*"</span> <span class="d">}</span>,
      <span class="b">"condition"</span>: <span class="d">{</span> <span class="b">"operator"</span>: <span class="d">"value >"</span>, <span class="b">"value"</span>: <span class="y">50</span> <span class="d">}</span>,
      <span class="b">"severity"</span>: <span class="y">"warning"</span>,
      <span class="b">"message"</span>: <span class="c">"Database pool size exceeds 50"</span>
    <span class="d">}</span>
  <span class="d">]</span>
<span class="d">}</span></pre>
        </div>
      </div>
    </section>

    <!-- ═══ sem vs git ═══ -->
    <section>
      <h2>sem vs git</h2>
      <p class="section-desc">
        git gives you lines. sem gives you entities — functions, properties, rows, sections.
      </p>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Feature</th>
              <th>git diff</th>
              <th>sem diff</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Diff granularity</td>
              <td class="lose">lines</td>
              <td class="win">entities (functions, classes, properties)</td>
            </tr>
            <tr>
              <td>Code parsing</td>
              <td class="lose">no</td>
              <td class="win">tree-sitter (TS, Python, Go, Rust, JS)</td>
            </tr>
            <tr>
              <td>JSON / YAML / TOML</td>
              <td class="lose">lines</td>
              <td class="win">key-path entities</td>
            </tr>
            <tr>
              <td>CSV</td>
              <td class="lose">lines</td>
              <td class="win">row + cell identity</td>
            </tr>
            <tr>
              <td>Rename detection</td>
              <td class="lose">heuristic (file-level)</td>
              <td class="win">3-phase (ID + hash + fuzzy)</td>
            </tr>
            <tr>
              <td>SQL queries</td>
              <td class="na">no</td>
              <td class="win">full SQLite</td>
            </tr>
            <tr>
              <td>Machine-readable output</td>
              <td class="lose">patch format</td>
              <td class="win">JSON + SQL</td>
            </tr>
            <tr>
              <td>Entity blame</td>
              <td class="lose">line-level only</td>
              <td class="win">entity-level</td>
            </tr>
            <tr>
              <td>Entity history</td>
              <td class="lose">file-level only</td>
              <td class="win">per-entity timeline</td>
            </tr>
            <tr>
              <td>PR review</td>
              <td class="lose">manual</td>
              <td class="win">semantic + risk signals</td>
            </tr>
            <tr>
              <td>Validation rules</td>
              <td class="na">no</td>
              <td class="win">.semrc.json</td>
            </tr>
            <tr>
              <td>Labels / Comments</td>
              <td class="na">no</td>
              <td class="win">on entities</td>
            </tr>
            <tr>
              <td>File watcher</td>
              <td class="na">no</td>
              <td class="win">sem watch</td>
            </tr>
            <tr>
              <td>Agent accuracy</td>
              <td class="lose">41.5% avg</td>
              <td class="win">95.9% avg (<a href="#agent-accuracy" style="color:var(--green)">benchmark</a>)</td>
            </tr>
            <tr>
              <td>Speed</td>
              <td class="win">20ms</td>
              <td class="win">30ms</td>
            </tr>
            <tr>
              <td>Adoption</td>
              <td>-</td>
              <td class="win">single binary, drop into any Git repo</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ═══ Benchmarks ═══ -->
    <section id="benchmarks">
      <h2>Benchmarks</h2>
      <p class="section-desc">
        Real measurements on the sem repo. 20 runs each via hyperfine, median reported. Compiled Rust binary with all tree-sitter grammars built in.
      </p>

      <div class="bench-group">
        <h3>sem diff across scenarios</h3>
        <p style="font-size: 12px; color: var(--dim); margin-bottom: 16px;">Wall-clock time including process startup. Measured with hyperfine --warmup 3.</p>
        <div class="bench-row">
          <div class="bench-label">
            <span class="name">Small commit (1 file)</span>
            <span class="value" style="color: var(--green)">11ms</span>
          </div>
          <div class="bench-bar-track">
            <div class="bench-bar sem-bar" style="width: 28%">11ms</div>
          </div>
        </div>
        <div class="bench-row">
          <div class="bench-label">
            <span class="name">Large commit (11 files)</span>
            <span class="value" style="color: var(--green)">22ms</span>
          </div>
          <div class="bench-bar-track">
            <div class="bench-bar sem-bar" style="width: 55%">22ms</div>
          </div>
        </div>
        <div class="bench-row">
          <div class="bench-label">
            <span class="name">Medium commit (7 files, TS + JSON)</span>
            <span class="value" style="color: var(--green)">30ms</span>
          </div>
          <div class="bench-bar-track">
            <div class="bench-bar sem-bar" style="width: 75%">30ms</div>
          </div>
        </div>
        <div class="bench-row">
          <div class="bench-label">
            <span class="name">Range (8 commits, 19 files)</span>
            <span class="value" style="color: var(--green)">40ms</span>
          </div>
          <div class="bench-bar-track">
            <div class="bench-bar sem-bar" style="width: 100%">40ms</div>
          </div>
        </div>
        <div class="bench-multiplier">Full semantic understanding in under 40ms. Scales linearly with file count.</div>
      </div>

      <div class="bench-group">
        <h3>sem diff vs git diff</h3>
        <p style="font-size: 12px; color: var(--dim); margin-bottom: 16px;">Same commit, same repo. sem adds entity-level parsing on top of git's line diff.</p>
        <div class="bench-row">
          <div class="bench-label">
            <span class="name">git diff (line-level only)</span>
            <span class="value">22ms</span>
          </div>
          <div class="bench-bar-track">
            <div class="bench-bar git-bar" style="width: 73%">22ms</div>
          </div>
        </div>
        <div class="bench-row">
          <div class="bench-label">
            <span class="name" style="color: var(--green)">sem diff (entity-level)</span>
            <span class="value" style="color: var(--green)">30ms</span>
          </div>
          <div class="bench-bar-track">
            <div class="bench-bar sem-bar" style="width: 100%">30ms</div>
          </div>
        </div>
        <div class="bench-multiplier">+8ms for full semantic parsing — functions, classes, properties, rename detection.</div>
      </div>

      <!-- Profiler breakdown -->
      <h3 style="font-size: 16px; color: var(--accent); margin: 40px 0 12px;">Internal profiler</h3>
      <p class="section-desc" style="margin-bottom: 16px;">
        Built-in instrumentation via <code style="color:var(--cyan)">sem diff --profile</code>. Shows where time is spent inside the binary.
      </p>

      <div class="profiler-grid">
        <div class="profiler-card" style="border-color: var(--green);">
          <h4 style="color: var(--green);">Small commit (1 file, 7ms)</h4>
          <div class="profiler-row">
            <span class="pr-label">git2 open repo</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 45%; background: var(--blue)"></div></div>
            <span class="pr-value">3.23ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">git diff + content</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 45%; background: var(--orange)"></div></div>
            <span class="pr-value">3.26ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">parse + match</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 9%; background: var(--green)"></div></div>
            <span class="pr-value">0.62ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">format output</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 2%; background: var(--purple)"></div></div>
            <span class="pr-value">0.12ms</span>
          </div>
          <div class="profiler-row" style="margin-top:8px; padding-top:8px; border-top:1px solid var(--border)">
            <span class="pr-label" style="color:var(--accent)">Total</span>
            <span class="pr-value" style="color:var(--green)">7.23ms</span>
          </div>
        </div>
        <div class="profiler-card" style="border-color: var(--green);">
          <h4 style="color: var(--green);">Medium commit (7 files, 23ms)</h4>
          <div class="profiler-row">
            <span class="pr-label">git2 open repo</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 5%; background: var(--blue)"></div></div>
            <span class="pr-value">1.22ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">git diff + content</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 20%; background: var(--orange)"></div></div>
            <span class="pr-value">4.68ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">parse + match</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 73%; background: var(--green)"></div></div>
            <span class="pr-value">16.78ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">format output</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 2%; background: var(--purple)"></div></div>
            <span class="pr-value">0.35ms</span>
          </div>
          <div class="profiler-row" style="margin-top:8px; padding-top:8px; border-top:1px solid var(--border)">
            <span class="pr-label" style="color:var(--accent)">Total</span>
            <span class="pr-value" style="color:var(--green)">23.05ms</span>
          </div>
        </div>
        <div class="profiler-card" style="border-color: var(--green);">
          <h4 style="color: var(--green);">Large commit (11 files, 14ms)</h4>
          <div class="profiler-row">
            <span class="pr-label">git2 open repo</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 9%; background: var(--blue)"></div></div>
            <span class="pr-value">1.24ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">git diff + content</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 29%; background: var(--orange)"></div></div>
            <span class="pr-value">4.24ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">parse + match</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 61%; background: var(--green)"></div></div>
            <span class="pr-value">8.83ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">format output</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 1%; background: var(--purple)"></div></div>
            <span class="pr-value">0.11ms</span>
          </div>
          <div class="profiler-row" style="margin-top:8px; padding-top:8px; border-top:1px solid var(--border)">
            <span class="pr-label" style="color:var(--accent)">Total</span>
            <span class="pr-value" style="color:var(--green)">14.42ms</span>
          </div>
        </div>
        <div class="profiler-card" style="border-color: var(--cyan);">
          <h4 style="color: var(--cyan);">Range — 8 commits (19 files, 31ms)</h4>
          <div class="profiler-row">
            <span class="pr-label">git2 open repo</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 4%; background: var(--blue)"></div></div>
            <span class="pr-value">1.27ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">git diff + content</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 21%; background: var(--orange)"></div></div>
            <span class="pr-value">6.62ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">parse + match</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 73%; background: var(--green)"></div></div>
            <span class="pr-value">23.03ms</span>
          </div>
          <div class="profiler-row">
            <span class="pr-label">format output</span>
            <div class="pr-bar"><div class="pr-fill" style="width: 2%; background: var(--purple)"></div></div>
            <span class="pr-value">0.55ms</span>
          </div>
          <div class="profiler-row" style="margin-top:8px; padding-top:8px; border-top:1px solid var(--border)">
            <span class="pr-label" style="color:var(--accent)">Total</span>
            <span class="pr-value" style="color:var(--cyan)">31.47ms</span>
          </div>
        </div>
      </div>

      <!-- Flame graph visualization -->
      <h3 style="font-size: 16px; color: var(--accent); margin: 40px 0 12px;">Flame graph</h3>
      <p class="section-desc" style="margin-bottom: 8px;">
        CPU time breakdown for <code style="color:var(--cyan)">sem diff --commit</code> (medium, 7 files). Hover for details.
      </p>
      <div class="flame-legend">
        <div class="flame-legend-item"><div class="flame-swatch" style="background:#3498db"></div> git2 repo</div>
        <div class="flame-legend-item"><div class="flame-swatch" style="background:#e67e22"></div> git diff + content</div>
        <div class="flame-legend-item"><div class="flame-swatch" style="background:#2ecc71"></div> tree-sitter parse</div>
        <div class="flame-legend-item"><div class="flame-swatch" style="background:#f1c40f"></div> entity matching</div>
        <div class="flame-legend-item"><div class="flame-swatch" style="background:#9b59b6"></div> format output</div>
      </div>
      <div id="flame-graph-mount"></div>
    </section>

    <!-- ═══ Agent Accuracy ═══ -->
    <section id="agent-accuracy">
      <h2>Agent accuracy</h2>
      <p class="section-desc">
        Same questions about code changes, answered by Claude Sonnet 4.5. One gets <code style="color:var(--green)">sem diff</code> JSON, the other gets raw <code style="color:var(--blue)">git diff</code>. Scored against ground truth across 3 commits (small, medium, large).
      </p>

      <div style="display: flex; gap: 14px; margin-bottom: 24px; font-size: 12px;">
        <div style="display: flex; align-items: center; gap: 6px;">
          <div style="width: 12px; height: 12px; border-radius: 2px; background: var(--green);"></div>
          <span style="color: var(--dim);">sem diff</span>
        </div>
        <div style="display: flex; align-items: center; gap: 6px;">
          <div style="width: 12px; height: 12px; border-radius: 2px; background: var(--blue);"></div>
          <span style="color: var(--dim);">git diff</span>
        </div>
      </div>

      <div class="bench-group" id="agent-bench-mount">
        <div class="bench-row">
          <div class="bench-label">
            <span class="name">Q1: List added functions (F1)</span>
            <span class="value" id="q1-values"></span>
          </div>
          <div style="display: flex; gap: 4px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar sem-bar" id="q1-sem-bar" style="width: 0%"></div>
            </div>
          </div>
          <div style="display: flex; gap: 4px; margin-top: 2px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar git-bar" id="q1-git-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="bench-row" style="margin-top: 16px;">
          <div class="bench-label">
            <span class="name">Q2: Files with modified entities (F1)</span>
            <span class="value" id="q2-values"></span>
          </div>
          <div style="display: flex; gap: 4px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar sem-bar" id="q2-sem-bar" style="width: 0%"></div>
            </div>
          </div>
          <div style="display: flex; gap: 4px; margin-top: 2px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar git-bar" id="q2-git-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="bench-row" style="margin-top: 16px;">
          <div class="bench-label">
            <span class="name">Q3: Entity type counts (accuracy)</span>
            <span class="value" id="q3-values"></span>
          </div>
          <div style="display: flex; gap: 4px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar sem-bar" id="q3-sem-bar" style="width: 0%"></div>
            </div>
          </div>
          <div style="display: flex; gap: 4px; margin-top: 2px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar git-bar" id="q3-git-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="bench-row" style="margin-top: 16px;">
          <div class="bench-label">
            <span class="name">Q4: Added/modified/deleted counts (exact)</span>
            <span class="value" id="q4-values"></span>
          </div>
          <div style="display: flex; gap: 4px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar sem-bar" id="q4-sem-bar" style="width: 0%"></div>
            </div>
          </div>
          <div style="display: flex; gap: 4px; margin-top: 2px;">
            <div class="bench-bar-track" style="flex:1">
              <div class="bench-bar git-bar" id="q4-git-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div id="agent-bench-overall" style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: baseline;">
          <span style="font-size: 14px; color: var(--accent); font-weight: 600;">Overall average</span>
          <span id="overall-values" style="font-size: 13px;"></span>
        </div>
        <div id="agent-bench-delta" class="bench-multiplier" style="margin-top: 8px;"></div>
      </div>

      <!-- Detailed findings -->
      <h3 style="font-size: 16px; color: var(--accent); margin: 40px 0 12px;">Why git diff fails agents</h3>
      <p class="section-desc" style="margin-bottom: 16px;">
        Tested on 3 commits from this repo. Each exposes a different failure mode when agents reason about raw line diffs.
      </p>

      <div class="finding-card">
        <h4>Line/entity confusion <span style="color: var(--dim); font-weight: 400;">— Q4 on all commits</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          git diff has no concept of "entity." When asked to count added entities, the model counts <code style="color:var(--cyan)">+</code> lines instead.
          On the speed optimization commit (<code style="color:var(--cyan)">fffb38f</code>), git-based Claude reported <span style="color:var(--red)">238 added</span> — the number of <code style="color:var(--cyan)">+</code> lines in the diff.
          The actual count is <span style="color:var(--green)">32 added entities</span>. On the Rust rewrite, it said <span style="color:var(--red)">1,122</span> vs truth of <span style="color:var(--green)">259</span>.
        </p>
        <div class="finding-example">
          <span class="d">git-based:</span> <span class="r">{"added": 238, "modified": 10, "deleted": 0}</span><br>
          <span class="d">sem-based:</span> <span class="g">{"added": 32, "modified": 10, "deleted": 3}</span> <span class="d">// exact match</span>
        </div>
      </div>

      <div class="finding-card">
        <h4>No entity type ontology <span style="color: var(--dim); font-weight: 400;">— Q3 on all commits</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          Line diffs have no AST. On commit <code style="color:var(--cyan)">9f7f1c7</code> (7 new commands), git-based Claude returned <code style="color:var(--red)">{"file": 11}</code> — it counted files, not entities.
          Truth: <code style="color:var(--green)">{"interface": 12, "function": 15, "variable": 3, "class": 1}</code>.
          On the Rust rewrite, it found 16 functions when there are 87, and completely missed <code style="color:var(--cyan)">chunk</code> (80), <code style="color:var(--cyan)">property</code> (29), <code style="color:var(--cyan)">impl</code> (10).
        </p>
      </div>

      <div class="finding-card">
        <h4>Can't distinguish add vs modify <span style="color: var(--dim); font-weight: 400;">— Q1, Q2</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          Modified functions show <code style="color:var(--cyan)">+</code> and <code style="color:var(--cyan)">-</code> hunks, same as new functions in changed files. On <code style="color:var(--cyan)">fffb38f</code>,
          git-based Claude listed 9 "added" functions — 4 were actually modified (<code style="color:var(--dim)">detectJsonChanges</code>, <code style="color:var(--dim)">parseDiffNameStatus</code>, <code style="color:var(--dim)">detectAndGetFiles</code>, <code style="color:var(--dim)">populateContent</code>).
          Precision dropped to 55.6%. sem tags each entity with <code style="color:var(--green)">changeType: "added"</code> vs <code style="color:var(--yellow)">changeType: "modified"</code>.
        </p>
      </div>

      <div class="finding-card">
        <h4>Config file blindness <span style="color: var(--dim); font-weight: 400;">— Q2, Q3</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          JSON/YAML/TOML changes appear as raw <code style="color:var(--cyan)">+</code>/<code style="color:var(--cyan)">-</code> key-value lines. The model doesn't classify these as "entities."
          On <code style="color:var(--cyan)">fffb38f</code>, git-based Claude missed <code style="color:var(--dim)">package.json</code> and <code style="color:var(--dim)">package-lock.json</code> as containing modified entities (recall dropped to 66.7%).
          sem reports <code style="color:var(--green)">entityType: "property"</code> for each changed key.
        </p>
      </div>

      <div class="finding-card">
        <h4>Context window pressure <span style="color: var(--dim); font-weight: 400;">— Q1 on large diffs</span></h4>
        <p style="font-size: 12px; color: var(--dim); line-height: 1.6;">
          Both tools degrade on the 3,905-line Rust rewrite (<code style="color:var(--cyan)">ae576ab</code>). git diff was truncated at 100KB — the model found 25/67 added functions (37% recall).
          sem's stripped JSON is much more compact (no source code), so the model saw all 278 entities but still only extracted 43/67 (64% recall).
          sem wins, but large diffs are where attention limits hurt regardless of format.
        </p>
      </div>

      <p style="font-size: 11px; color: var(--dim2); margin-top: 20px;">
        3 commits &times; 4 questions &times; 2 tools = 24 API calls. Claude Sonnet 4.5, temperature 0. Content fields stripped from sem JSON for fair comparison.
        <a href="https://github.com/Ataraxy-Labs/sem/blob/main/bench/agent-accuracy.py" style="color: var(--dim);">Reproduce &rarr;</a>
      </p>
    </section>

    <!-- ═══ Changelog ═══ -->
    <section id="changelog">
      <h2>Changelog</h2>
      <p class="section-desc">
        How sem evolved — including the mistakes.
      </p>

      <div class="changelog-entry">
        <div class="changelog-title">
          <span class="changelog-sha">01edf1f</span>
          <span class="changelog-tag feat">feat</span>
          Initial release
        </div>
        <p class="changelog-body">
          First working version. <code style="color:var(--cyan)">sem diff</code> with tree-sitter parsing for TypeScript, JavaScript, Python, Go, Rust.
          JSON/YAML/TOML/CSV/Markdown support via custom parsers. Three-phase entity matching (exact ID, content hash, fuzzy similarity).
        </p>
        <p class="changelog-stats">Node.js + TypeScript &bull; tsup build &bull; better-sqlite3 for storage &bull; ~290ms cold start</p>
        <div class="changelog-mistake">
          <strong>Mistake: Node.js startup overhead.</strong> The entire runtime — V8 init, module resolution, dynamic imports of tree-sitter WASM binaries — took ~120ms before any real work began. For a CLI tool that should feel instant, this was a problem we didn't think about until we started measuring.
        </div>
      </div>

      <div class="changelog-entry">
        <div class="changelog-title">
          <span class="changelog-sha">9f7f1c7</span>
          <span class="changelog-tag feat">feat</span>
          7 new commands
        </div>
        <p class="changelog-body">
          Added <code style="color:var(--cyan)">blame</code>, <code style="color:var(--cyan)">status</code>, <code style="color:var(--cyan)">watch</code>, <code style="color:var(--cyan)">review</code>, <code style="color:var(--cyan)">history</code>, <code style="color:var(--cyan)">label</code>, <code style="color:var(--cyan)">comment</code>.
          Entity-level blame (who last touched each function), semantic PR review with risk signals, real-time file watching, threaded comments on entities.
        </p>
        <p class="changelog-stats">+1,191 lines &bull; 12 files &bull; 15 functions, 12 interfaces, 3 variables, 1 class added</p>
      </div>

      <div class="changelog-entry">
        <div class="changelog-title">
          <span class="changelog-sha">fffb38f</span>
          <span class="changelog-tag perf">perf</span>
          591ms &rarr; 260ms (56% faster)
        </div>
        <p class="changelog-body">
          Parallelized git operations. Replaced sequential <code style="color:var(--cyan)">simple-git</code> calls with batched <code style="color:var(--cyan)">diff --name-status</code> + <code style="color:var(--cyan)">show</code>. Lazy-loaded parsers instead of importing all grammars upfront. Added internal benchmarking harness.
        </p>
        <p class="changelog-stats">+705 lines &bull; 32 added, 10 modified, 3 deleted entities across 5 types</p>
        <div class="changelog-mistake">
          <strong>Mistake: optimizing the wrong layer.</strong> We spent a week shaving milliseconds off the Node.js implementation — lazy imports, worker threads, caching git objects. Got from 591ms to 260ms, which felt like a win. But 120ms of that was still V8 startup that no amount of application-level optimization could touch. The real fix was switching runtimes entirely.
        </div>
      </div>

      <div class="changelog-entry">
        <div class="changelog-title">
          <span class="changelog-sha">ae576ab</span>
          <span class="changelog-tag rewrite">rewrite</span>
          Rust rewrite: 30ms (10x faster)
        </div>
        <p class="changelog-body">
          Rewrote <code style="color:var(--cyan)">sem diff</code> as a compiled Rust binary. git2 for in-process git operations (no subprocess spawning), tree-sitter grammars compiled directly into the binary (no WASM, no dynamic loading).
          Cargo workspace: <code style="color:var(--cyan)">sem-core</code> (library) + <code style="color:var(--cyan)">sem-cli</code> (binary). All 7 parser plugins ported.
        </p>
        <p class="changelog-stats">+3,905 lines &bull; 278 entities &bull; 11 entity types including Rust-specific (struct, impl, trait)</p>
        <div class="changelog-mistake">
          <strong>Lesson: where the time actually goes.</strong> Node.js breakdown: ~120ms V8 startup, ~80ms module resolution, ~50ms WASM grammar load, ~40ms git subprocess spawn.
          Rust breakdown: ~3ms binary load, ~5ms git2 repo open, ~17ms parse + match. The entire Rust binary finishes before Node even loads its first module.
          We should have started in Rust — but building in Node first let us iterate on the algorithm fast, and the Rust port was straightforward because the architecture was already proven.
        </div>
      </div>

      <div class="changelog-entry">
        <div class="changelog-title">
          <span class="changelog-sha">bench</span>
          <span class="changelog-tag docs">bench</span>
          Agent accuracy benchmark
        </div>
        <p class="changelog-body">
          Proved that AI agents are 2.3x more accurate at answering questions about code changes when given <code style="color:var(--green)">sem diff</code> JSON vs raw <code style="color:var(--blue)">git diff</code> output.
          Tested with Claude Sonnet 4.5 across 4 question types and 3 commits of varying size.
          Core finding: line diffs cause systematic failures — the model confuses lines with entities, can't distinguish adds from modifications, and has no entity type vocabulary.
        </p>
        <p class="changelog-stats">24 API calls &bull; sem 95.9% avg accuracy vs git 41.5% &bull; +54.4% delta</p>
      </div>

      <div class="changelog-entry">
        <div class="changelog-title">
          <span class="changelog-sha">next</span>
          <span class="changelog-tag feat">feat</span>
          Homebrew distribution
        </div>
        <p class="changelog-body">
          <code style="color:var(--cyan)">brew install sem-diff</code> — single command install via Homebrew tap.
          Formula builds from source using Cargo, compiles all tree-sitter grammars in, links against system libgit2.
          Includes a test that verifies entity extraction on a Python function.
        </p>
        <p class="changelog-stats">3 install methods: Homebrew (recommended) &bull; curl installer &bull; cargo install from source</p>
        <div class="changelog-mistake">
          <strong>Lesson: distribution matters as much as the tool.</strong> A fast binary that's hard to install doesn't get adopted.
          We started with <code style="color:var(--dim)">npm install -g</code>, then a curl script, and finally Homebrew.
          Each step removed friction — Homebrew handles updates, dependencies, and uninstall for free.
        </div>
      </div>
    </section>

    <footer>
      <p>Built by <a href="https://github.com/Ataraxy-Labs">Ataraxy Labs</a></p>
    </footer>
  </div>

  <!-- Flame graph tooltip -->
  <div class="flame-tooltip" id="tooltip">
    <div class="tt-fn" id="tt-fn"></div>
    <div class="tt-detail" id="tt-detail"></div>
  </div>

  <script>
    function copyCmd(el, cmd) {
      navigator.clipboard.writeText(cmd);
      // Find or create a "copied" indicator
      let copied = el.querySelector('.copied');
      if (copied) {
        copied.classList.add('show');
        setTimeout(() => copied.classList.remove('show'), 1500);
      }
    }
    // Legacy compat
    function copyInstall(el) { copyCmd(el, 'brew install sem-diff'); }

    // Flame graph rendering — sem diff internal profiler
    (function() {
      // Profiler data from sem diff --profile (medium commit, 7 files)
      const flameData = {
        name: 'root', self: 0, total: 2305,
        children: [
          { name: 'git2 open repo', self: 0, total: 122, children: [
            { name: 'Repository::discover [git2]', self: 78, total: 78, children: [] },
            { name: 'Config::open_default', self: 24, total: 24, children: [] },
            { name: 'load HEAD reference', self: 20, total: 20, children: [] },
          ]},
          { name: 'git diff + content', self: 0, total: 468, children: [
            { name: 'diff_tree_to_tree [git2]', self: 112, total: 112, children: [] },
            { name: 'Blob::content (old)', self: 98, total: 98, children: [] },
            { name: 'Blob::content (new)', self: 94, total: 94, children: [] },
            { name: 'Tree::get_path lookup', self: 86, total: 86, children: [] },
            { name: 'parse_diff_status', self: 48, total: 48, children: [] },
            { name: 'revparse_single', self: 30, total: 30, children: [] },
          ]},
          { name: 'parse + match', self: 0, total: 1678, children: [
            { name: 'tree-sitter parse', self: 0, total: 890, children: [
              { name: 'Parser::parse (TypeScript)', self: 520, total: 520, children: [] },
              { name: 'Parser::parse (JSON)', self: 180, total: 180, children: [] },
              { name: 'Parser::set_language', self: 42, total: 42, children: [] },
              { name: 'tree cursor walk', self: 148, total: 148, children: [] },
            ]},
            { name: 'entity extraction', self: 0, total: 480, children: [
              { name: 'extract_entities (code)', self: 310, total: 310, children: [] },
              { name: 'extract_entities (json)', self: 92, total: 92, children: [] },
              { name: 'build_entity_id + hash', self: 78, total: 78, children: [] },
            ]},
            { name: 'match_entities [identity]', self: 0, total: 308, children: [
              { name: 'Phase 1: exact ID match', self: 124, total: 124, children: [] },
              { name: 'Phase 2: content hash', self: 98, total: 98, children: [] },
              { name: 'Phase 3: fuzzy similarity', self: 86, total: 86, children: [] },
            ]},
          ]},
          { name: 'format output', self: 0, total: 35, children: [
            { name: 'format_terminal', self: 28, total: 28, children: [] },
            { name: 'write to stdout', self: 7, total: 7, children: [] },
          ]},
          { name: 'registry init', self: 2, total: 2, children: [] },
        ]
      };

      const mount = document.getElementById('flame-graph-mount');
      const tooltip = document.getElementById('tooltip');
      const ttFn = document.getElementById('tt-fn');
      const ttDetail = document.getElementById('tt-detail');

      const WIDTH = 760;
      const ROW_H = 22;
      const totalSamples = flameData.total;

      function getColor(name) {
        if (name.includes('git2') || name.includes('Repository') || name.includes('Config') || name.includes('HEAD')) return '#3498db';
        if (name.includes('diff') || name.includes('Blob') || name.includes('Tree') || name.includes('revparse')) return '#e67e22';
        if (name.includes('tree-sitter') || name.includes('Parser') || name.includes('cursor')) return '#2ecc71';
        if (name.includes('match') || name.includes('Phase') || name.includes('similarity') || name.includes('hash') || name.includes('identity')) return '#f1c40f';
        if (name.includes('extract') || name.includes('entity') || name.includes('build_entity')) return '#2ecc71';
        if (name.includes('format') || name.includes('stdout') || name.includes('registry')) return '#9b59b6';
        if (name.includes('parse + match')) return '#2ecc71';
        return '#9b59b6';
      }

      const rects = [];
      function layout(node, depth, x0) {
        if (node.name !== 'root') {
          const w = (node.total / totalSamples) * WIDTH;
          if (w >= 2) {
            rects.push({ name: node.name, x: x0, depth, w, self: node.self, total: node.total });
          }
        }
        let cx = x0;
        for (const child of node.children) {
          const cw = (child.total / totalSamples) * WIDTH;
          layout(child, node.name === 'root' ? depth : depth + 1, cx);
          cx += cw;
        }
      }
      layout(flameData, 0, 0);

      const maxDepth = rects.reduce((m, r) => Math.max(m, r.depth), 0);
      const svgH = (maxDepth + 2) * ROW_H + 8;

      const fContainer = document.createElement('div');
      fContainer.className = 'flame-container';

      const fHeader = document.createElement('div');
      fHeader.className = 'flame-header';
      fHeader.innerHTML = '<span>sem diff --profile</span><span class="flame-stats">23.05ms internal | 7 files | 30ms wall</span>';
      fContainer.appendChild(fHeader);

      const fBody = document.createElement('div');
      fBody.className = 'flame-body';

      const ns = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(ns, 'svg');
      svg.setAttribute('width', WIDTH);
      svg.setAttribute('height', svgH);
      svg.style.display = 'block';

      rects.forEach(r => {
        const g = document.createElementNS(ns, 'g');
        const ry = svgH - (r.depth + 1) * ROW_H - 4;
        const rect = document.createElementNS(ns, 'rect');
        rect.setAttribute('x', r.x);
        rect.setAttribute('y', ry);
        rect.setAttribute('width', Math.max(r.w - 1, 1));
        rect.setAttribute('height', ROW_H - 2);
        rect.setAttribute('fill', getColor(r.name));
        rect.setAttribute('rx', 3);
        rect.style.opacity = '0.8';
        rect.style.cursor = 'default';
        rect.style.transition = 'opacity 0.15s';
        g.appendChild(rect);

        if (r.w > 50) {
          const text = document.createElementNS(ns, 'text');
          text.setAttribute('x', r.x + 6);
          text.setAttribute('y', ry + 15);
          text.setAttribute('fill', '#000');
          text.setAttribute('font-size', '11');
          text.setAttribute('font-family', 'SF Mono, Fira Code, monospace');
          const maxChars = Math.floor(r.w / 7.5);
          text.textContent = r.name.length > maxChars ? r.name.slice(0, maxChars - 1) + '..' : r.name;
          text.style.pointerEvents = 'none';
          g.appendChild(text);
        }

        g.addEventListener('mouseenter', () => {
          rect.style.opacity = '1';
          rect.setAttribute('stroke', '#fff');
          rect.setAttribute('stroke-width', '1');
          ttFn.textContent = r.name;
          const ms = (r.total / totalSamples * 23.05).toFixed(2);
          const pct = (r.total / totalSamples * 100).toFixed(1);
          ttDetail.textContent = ms + 'ms (' + pct + '% of total)';
          tooltip.style.display = 'block';
        });
        g.addEventListener('mousemove', (e) => {
          tooltip.style.left = (e.clientX + 12) + 'px';
          tooltip.style.top = (e.clientY - 40) + 'px';
        });
        g.addEventListener('mouseleave', () => {
          rect.style.opacity = '0.8';
          rect.removeAttribute('stroke');
          tooltip.style.display = 'none';
        });

        svg.appendChild(g);
      });

      fBody.appendChild(svg);
      fContainer.appendChild(fBody);
      mount.appendChild(fContainer);
    })();

    // Agent accuracy benchmark results
    // Updated by bench/agent-accuracy.py — replace this block with real data after running
    (function() {
      const data = {
        q1_added_functions:{ sem: 0.9274, git: 0.7526 },
        q2_files_with_modified:{ sem: 1.0000, git: 0.5519 },
        q3_entity_type_counts:{ sem: 0.9083, git: 0.1346 },
        q4_change_type_counts:{ sem: 1.0000, git: 0.2222 },
      };

      const qs = ['q1', 'q2', 'q3', 'q4'];
      const keys = ['q1_added_functions', 'q2_files_with_modified', 'q3_entity_type_counts', 'q4_change_type_counts'];

      keys.forEach((key, i) => {
        const q = qs[i];
        const sem = data[key].sem;
        const git = data[key].git;
        const semBar = document.getElementById(q + '-sem-bar');
        const gitBar = document.getElementById(q + '-git-bar');
        const values = document.getElementById(q + '-values');
        if (semBar) semBar.style.width = (sem * 100) + '%';
        if (gitBar) gitBar.style.width = (git * 100) + '%';
        if (semBar) semBar.textContent = sem > 0.08 ? (sem * 100).toFixed(0) + '%' : '';
        if (gitBar) gitBar.textContent = git > 0.08 ? (git * 100).toFixed(0) + '%' : '';
        if (values) values.innerHTML = '<span style="color:var(--green)">' + (sem * 100).toFixed(0) + '%</span> vs <span style="color:var(--blue)">' + (git * 100).toFixed(0) + '%</span>';
      });

      const allSem = keys.map(k => data[k].sem);
      const allGit = keys.map(k => data[k].git);
      const semAvg = allSem.reduce((a,b) => a+b, 0) / allSem.length;
      const gitAvg = allGit.reduce((a,b) => a+b, 0) / allGit.length;
      const overall = document.getElementById('overall-values');
      if (overall) overall.innerHTML = '<span style="color:var(--green)">' + (semAvg * 100).toFixed(0) + '%</span> vs <span style="color:var(--blue)">' + (gitAvg * 100).toFixed(0) + '%</span>';
      const delta = document.getElementById('agent-bench-delta');
      if (delta && semAvg > gitAvg) {
        const pct = ((semAvg - gitAvg) / gitAvg * 100).toFixed(0);
        delta.textContent = 'Structured sem diff improves agent accuracy by +' + pct + '% over raw line diffs.';
      }
    })();
  </script>
</body>
</html>
